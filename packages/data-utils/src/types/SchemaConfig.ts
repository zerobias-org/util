/**
 * Schema configuration types for DataProducer Schema generation
 */

/**
 * Options for loading OpenAPI specs from URLs
 */
export interface UrlLoadOptions {
  /** Request headers (for auth tokens, API keys, etc.) */
  headers?: Record<string, string>;
  /** Request timeout in milliseconds (default: 30000) */
  timeout?: number;
  /** Force content type parsing: 'json' | 'yaml' | 'auto' (default: 'auto') */
  contentType?: 'json' | 'yaml' | 'auto';
}

/**
 * Reference to another schema for relationships
 */
export interface SchemaReference {
  /** ID of the referenced schema */
  schemaId: string;
  /** Optional property name in the referenced schema */
  propertyName?: string;
}

/**
 * Base configuration for schema generation
 */
export interface SchemaConfig {
  /** Unique schema identifier (e.g., 'github_repository_schema') */
  schemaId: string;

  /** Array of property names that form the primary key */
  primaryKeys?: string[];

  /** Map of property names to schema references (for nested objects) */
  references?: Record<string, SchemaReference>;
}

/**
 * Configuration for building Schema from OpenAPI specification
 */
export interface OpenAPISchemaConfig extends SchemaConfig {
  /** Path to OpenAPI spec file, URL, or parsed OpenAPI object */
  openApiSpec: string | object | URL;

  /** Name of the schema in components.schemas (e.g., 'Repository', 'PullRequest') */
  schemaName: string;

  /** Options for URL loading (headers, timeout, etc.) */
  urlOptions?: UrlLoadOptions;
}

/**
 * Configuration for building Schema from TypeScript interfaces
 */
export interface TypeScriptSchemaConfig extends SchemaConfig {
  /** Generated TypeScript class with attributeTypeMap static property */
  modelClass: ModelClass;

  /** Optional: Path to OpenAPI spec for enriching with descriptions/required fields */
  openApiSpec?: string | object;

  /** Optional: Schema name in OpenAPI spec (defaults to class name) */
  openApiSchemaName?: string;
}

/**
 * TypeScript model class structure (generated by codegen)
 */
export interface ModelClass {
  /** Static array of attribute type mappings */
  attributeTypeMap: ReadonlyArray<AttributeTypeMap>;
  /** Class name (optional, may not be preserved after compilation) */
  name?: string;
}

/**
 * Attribute type map entry from generated TypeScript classes
 */
export interface AttributeTypeMap {
  /** Property name in camelCase */
  name: string;
  /** Base property name (original from OpenAPI, usually snake_case) */
  baseName: string;
  /** TypeScript type string (e.g., 'string', 'Array<Label>', 'Email') */
  type: string;
  /** OpenAPI format hint (e.g., 'email', 'date-time', 'uri') */
  format: string;
}
