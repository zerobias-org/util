/**
 * {{appName}} Test Client Factory
 *
 * Generated test client for use with @zerobias-org/module-tester framework.
 * Provides typed access to module APIs for Docker container testing.
 *
 * This file is AUTO-GENERATED from the OpenAPI specification.
 * Do not edit this file directly.
 *
 * @generator hub-module-test-client
 * @version {{appVersion}}
 */

import type { ModuleTestHarness } from '@zerobias-org/module-tester';
{{#imports}}
import { {{classname}} } from '../model/{{filename}}.js';
{{/imports}}

{{#apiInfo}}
{{#apis}}
{{#operations}}
/**
 * {{classname}} interface
 * Wire protocol: POST /connections/{connectionId}/{{classname}}.{method}
 */
export interface {{classname}}TestClient {
{{#operation}}
  /**
   * {{summary}}
   {{#notes}}
   * {{&notes}}
   {{/notes}}
   {{#allParams}}
   * @param {{paramName}} {{description}}
   {{/allParams}}
   */
  {{nickname}}({{#allParams}}{{paramName}}{{^required}}?{{/required}}: {{{dataType}}}{{^-last}}, {{/-last}}{{/allParams}}): Promise<{{#returnType}}{{{returnType}}}{{/returnType}}{{^returnType}}void{{/returnType}}>;

{{/operation}}
}

{{/operations}}
{{/apis}}
{{/apiInfo}}

/**
 * Complete test client with all API groups
 */
export interface {{apiName}}TestClient {
{{#apiInfo}}
{{#apis}}
  {{#operations}}
  {{nickname}}: {{classname}}TestClient;
  {{/operations}}
{{/apis}}
{{/apiInfo}}
}

/**
 * Response wrapper type for pagination
 * Many modules wrap array responses despite OpenAPI spec
 */
export interface PagedResponse<T> {
  items: T[];
  count?: number;
  pageNumber?: number;
  pageSize?: number;
  pageToken?: string;
}

/**
 * Create typed test client for {{appName}}
 *
 * @param harness - ModuleTestHarness instance
 * @param connectionId - Connection ID for this test session
 * @returns Typed client with all API groups
 *
 * @example
 * ```typescript
 * import { moduleTest } from '@zerobias-org/module-tester';
 * import { createTestClient } from './client-factory.js';
 *
 * moduleTest('my-module', { debug: true }, (harness, connectionId) => {
 *   const client = createTestClient(harness, connectionId);
 *
 *   it('should work', async () => {
 *     const result = await client.someApi.someMethod({ param: 'value' });
 *     expect(result).to.be.ok;
 *   });
 * });
 * ```
 */
export function createTestClient(
  harness: ModuleTestHarness,
  connectionId: string
): {{apiName}}TestClient {
  return {
{{#apiInfo}}
{{#apis}}
{{#operations}}
    {{nickname}}: {
{{#operation}}
      {{nickname}}: {{#vendorExtensions.x-returns-array}}async {{/vendorExtensions.x-returns-array}}({{#allParams}}{{paramName}}{{^required}}?{{/required}}: {{{dataType}}}{{^-last}}, {{/-last}}{{/allParams}}) =>{{#vendorExtensions.x-returns-array}} {
        // Array response - may need unwrapping if module uses pagination wrapper
        const response = await harness.invokeMethod<PagedResponse<{{returnBaseType}}>>(
          '{{classname}}',
          '{{operationId}}',
          { {{#allParams}}{{paramName}}{{^-last}}, {{/-last}}{{/allParams}} },
          connectionId
        );
        // Check if response is wrapped - unwrap if needed
        if (response && typeof response === 'object' && 'items' in response) {
          return response.items;
        }
        return response as unknown as {{{returnType}}};
      }{{/vendorExtensions.x-returns-array}}{{^vendorExtensions.x-returns-array}}
        harness.invokeMethod<{{#returnType}}{{{returnType}}}{{/returnType}}{{^returnType}}void{{/returnType}}>(
          '{{classname}}',
          '{{operationId}}',
          { {{#allParams}}{{paramName}}{{^-last}}, {{/-last}}{{/allParams}} },
          connectionId
        ){{/vendorExtensions.x-returns-array}},
{{/operation}}
    },
{{/operations}}
{{/apis}}
{{/apiInfo}}
  };
}
